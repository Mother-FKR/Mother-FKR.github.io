<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CSE116的学习笔记-Lec5-2:Testing_Actors | Tianzhe's blog</title><meta name="description" content="关于我在CSE-116中的笔记：Testing Actors"><meta name="keywords" content="Scala,教程,CSE116"><meta name="author" content="胡天哲,tianzheh@buffalo.edu"><meta name="copyright" content="胡天哲"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/image/favicon.jpeg"><link rel="canonical" href="https://tianzhe.me/2020/12/27/LO5-2-Testing-Actors/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="E3ldS1S2QwwG6Wt7hTzCzP8cEsZe4qy7GuQn5C9D5Fk"/><meta name="msvalidate.01" content="E3ldS1S2QwwG6Wt7hTzCzP8cEsZe4qy7GuQn5C9D5Fk"/><meta name="baidu-site-verification" content="RZuOf3nNVc"/><meta property="og:type" content="article"><meta property="og:title" content="CSE116的学习笔记-Lec5-2:Testing_Actors"><meta property="og:url" content="https://tianzhe.me/2020/12/27/LO5-2-Testing-Actors/"><meta property="og:site_name" content="Tianzhe's blog"><meta property="og:description" content="关于我在CSE-116中的笔记：Testing Actors"><meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><meta property="article:published_time" content="2020-12-27T17:50:13.000Z"><meta property="article:modified_time" content="2020-12-27T19:45:37.192Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '天',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
      const now = new Date()
      const expiryDay = ttl * 86400000
      const item = {
        value: value,
        expiry: now.getTime() + expiryDay,
      }
      localStorage.setItem(key, JSON.stringify(item))
    },
  
  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isSidebar: true,
  postUpdate: '2020-12-27 14:45:37'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = '1'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://avatars1.githubusercontent.com/u/62329498?s=400&amp;u=20198ec972904a758bc5f6ba4888c5ac6b6270fb&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页🏠</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴⌚️</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签🏷️</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类📖</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 清单🧾</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐🎵</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影🎬</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 好友👬</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于👴</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Testing-Actors"><span class="toc-number">1.</span> <span class="toc-text">Testing Actors</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Traits-and-Mixins"><span class="toc-number">2.</span> <span class="toc-text">Traits and Mixins</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Testing-Actors-1"><span class="toc-number">3.</span> <span class="toc-text">Testing Actors</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Testing-Actors-Library"><span class="toc-number">4.</span> <span class="toc-text">Testing Actors - Library</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Testing-Actors-Setup"><span class="toc-number">5.</span> <span class="toc-text">Testing Actors - Setup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Testing-Actors-2"><span class="toc-number">6.</span> <span class="toc-text">Testing Actors</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lecture-Question"><span class="toc-number">7.</span> <span class="toc-text">Lecture Question</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Tianzhe's blog</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页🏠</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴⌚️</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签🏷️</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类📖</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 清单🧾</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐🎵</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影🎬</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 好友👬</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于👴</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">CSE116的学习笔记-Lec5-2:Testing_Actors</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-27T17:50:13.000Z" title="发表于 2020-12-27 12:50:13">2020-12-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-27T19:45:37.192Z" title="更新于 2020-12-27 14:45:37">2020-12-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/CSE116/">CSE116</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/CSE116/Scala/">Scala</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Testing-Actors"><a href="#Testing-Actors" class="headerlink" title="Testing Actors"></a>Testing Actors</h1><p>testing the actors:)</p>
<h1 id="Traits-and-Mixins"><a href="#Traits-and-Mixins" class="headerlink" title="Traits and Mixins"></a>Traits and Mixins</h1><ul>
<li>We’ve seen inheritance by extending abstract class</li>
<li>What if we want to extend multiple classes?<ul>
<li>Example: You want an object class that extends PhysicalObject to have physics applied and extend Actor to run concurrently</li>
<li><strong>This is not allowed</strong></li>
</ul>
</li>
<li>Can avoid this need by using composition<ul>
<li>Make a class that extends actor and stores a PhysicalObject in a state variable</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>Traits<ul>
<li>Similar to abstract classes</li>
<li><strong>Cannot have a constructor</strong></li>
</ul>
</li>
<li>No limit to the number of traits that can be extended<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">playerExists</span></span>(username: <span class="type">String</span>): <span class="type">Boolean</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createPlayer</span></span>(username: <span class="type">String</span>): <span class="type">Unit</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">saveGameState</span></span>(username: <span class="type">String</span>, gameState: <span class="type">String</span>): <span class="type">Unit</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadGameState</span></span>(username: <span class="type">String</span>): <span class="type">String</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<br>

<ul>
<li>Mixins<ul>
<li>When extending multiple traits, we use the term mixin(ie. The traits are mixed into the class)</li>
</ul>
</li>
<li>Extend any one class / abstract class / trait using “extends”</li>
<li>Add any number of Traits using “with”</li>
<li>Must implement all abstract methods from all inheritances<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActorAndDatabase</span> <span class="keyword">extends</span> <span class="title">Actor</span> <span class="keyword">with</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">receive</span></span>: <span class="type">Receive</span> = &#123;</span><br><span class="line">        case_ =&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">playerExists</span></span>(username: <span class="type">String</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">createPlayer</span></span>(username: <span class="type">String</span>): <span class="type">Unit</span> = &#123;&#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">saveGameState</span></span>(username: <span class="type">String</span>, gameState: <span class="type">String</span>): <span class="type">Unit</span> = &#123;&#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">loadGameState</span></span>(username: <span class="type">String</span>): <span class="type">String</span> = &#123;</span><br><span class="line">        <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Testing-Actors-1"><a href="#Testing-Actors-1" class="headerlink" title="Testing Actors"></a>Testing Actors</h1><ul>
<li>We’ve seen our first actor system where multiple actors can run concurrently</li>
<li><strong>But how would we test such a program?</strong></li>
<li>Use a FunSuite like we have all semester?<ul>
<li>FunSuite starts the actor system</li>
<li>Creates actors</li>
<li>Send messages</li>
<li>Runds some asserts that likely execuye <strong>before</strong> the first message is received by an actor</li>
</ul>
</li>
<li>Can wait with Thread.sleep to wait for messages, but the FunSuite can’t receive messages from the actors<ul>
<li>Now way of gainning infomation from the actors</li>
</ul>
</li>
</ul>
<h1 id="Testing-Actors-Library"><a href="#Testing-Actors-Library" class="headerlink" title="Testing Actors - Library"></a>Testing Actors - Library</h1><ul>
<li>Let’s pull in a new library to help us out</li>
<li>The testing library we’ll use is the Akka testkit</li>
<li>Make sure thr version number matches your version of the Akka actor library<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-testkit_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Testing-Actors-Setup"><a href="#Testing-Actors-Setup" class="headerlink" title="Testing Actors - Setup"></a>Testing Actors - Setup</h1><ul>
<li>Using this library, we’ll setup a new type of TestSuite using the TestKit class</li>
<li>This setup is directly from the test kit documentation and can be reused whenever you setup a test suite for actors<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> akka.testkit.&#123;<span class="type">ImplicitSender</span>, <span class="type">TestKit</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.scalatest.&#123;<span class="type">BeforeAndAfterAll</span>, <span class="type">Matchers</span>, <span class="type">WordSpecLike</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.concurrent.duration._</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestActors</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">TestKit</span>(<span class="params"><span class="type">ActorSystem</span>(&quot;<span class="type">TestStringActor</span>&quot;</span>)) <span class="keyword">with</span> <span class="title">ImplicitSender</span></span></span><br><span class="line"><span class="class">    <span class="keyword">with</span> <span class="title">WordSpecLike</span></span></span><br><span class="line"><span class="class">    <span class="keyword">with</span> <span class="title">Matchers</span></span></span><br><span class="line"><span class="class">    <span class="keyword">with</span> <span class="title">BeforeAndAfterAll</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">afterAll</span></span>: <span class="type">Unit</span> = &#123; </span><br><span class="line">        <span class="type">TestKit</span>.shutdownActorSystem(system)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;A string actor&quot;</span> must &#123; </span><br><span class="line">        <span class="string">&quot;track a string&quot;</span> in &#123; </span><br><span class="line">            <span class="comment">// Test actors here</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<br>

<ul>
<li>Import classes / traits from the libraries</li>
<li>The test kit is built on top of scalatest so we’ll use both libraries</li>
<li>Import the duration package from Scala to use 100.millis syntax<ul>
<li>Important: This muest be manually added. IntelliJ will not suggest importing the duration package and you will have an error on you millis</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>Extend the TestKit class which has a constructor that takes an ActorSystem</li>
<li>Name and Create a new ActorSystem directly in the constructor</li>
</ul>
<br>

<ul>
<li>Mixin traits for additional functionality</li>
<li>These traits contain defined methods<ul>
<li>No abstract methods that need to be implemented</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>From tje BeforeAndAfterAll trait, we inherited the afterAll method which is called after all our tests complete</li>
<li>By default, afterAll is implement but does nothing</li>
<li>We override afterAll to properly shutdown the actor system</li>
</ul>
<br>

<ul>
<li>Finally, we can setup our tests</li>
<li>Instead of unit testing, the test kit uses behavioral tests<ul>
<li>Name tests by the expect behavior of your code</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>Methods “must” and “in” are inherited from WordSpecLike and are called inline<ul>
<li>Uses a string wrapper class (ie. “A value actor” is implicitly converted to the wrapper class which contains the must method)</li>
</ul>
</li>
<li>All this to achieve more human readable syntax</li>
</ul>
<h1 id="Testing-Actors-2"><a href="#Testing-Actors-2" class="headerlink" title="Testing Actors"></a>Testing Actors</h1><ul>
<li>With the test suite setup, we’re ready to start testing our actors</li>
<li>We have access to the actor system we created in the constructor in the system variable<ul>
<li>Use this system to start your actor(s)<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;A string actor&quot;</span> must &#123;</span><br><span class="line">    <span class="string">&quot;track a string&quot;</span> in &#123;</span><br><span class="line">        <span class="keyword">val</span> valueActor = system.actorOf(<span class="type">Props</span>(classOf[<span class="type">StringActor</span>], <span class="string">&quot;Hello&quot;</span>))</span><br><span class="line"></span><br><span class="line">        valueActor ! <span class="type">Append</span>(<span class="string">&quot; CSE&quot;</span>)</span><br><span class="line">        valueActor ! <span class="type">Append</span>(<span class="string">&quot;116&quot;</span>)</span><br><span class="line"></span><br><span class="line">        expectNoMessage(<span class="number">100.</span>millis)</span><br><span class="line"></span><br><span class="line">        valueActor ! <span class="type">GetValue</span></span><br><span class="line">        <span class="keyword">val</span> value: <span class="type">Value</span> = expectMsgType[<span class="type">Value</span>](<span class="number">1000.</span>millis)</span><br><span class="line"></span><br><span class="line">        assert(value == <span class="type">Value</span>(<span class="string">&quot;Hello CSE116&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>Send messages to the actor using the ! method<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;A string actor&quot;</span> must &#123;</span><br><span class="line">    <span class="string">&quot;track a string&quot;</span> in &#123;</span><br><span class="line">        <span class="keyword">val</span> valueActor = system.actorOf(<span class="type">Props</span>(classOf[<span class="type">StringActor</span>], <span class="string">&quot;Hello&quot;</span>))</span><br><span class="line"></span><br><span class="line">        valueActor ! <span class="type">Append</span>(<span class="string">&quot; CSE&quot;</span>)</span><br><span class="line">        expectNoMessage(<span class="number">100.</span>millis)</span><br><span class="line">        valueActor ! <span class="type">Append</span>(<span class="string">&quot;116&quot;</span>)</span><br><span class="line">        expectNoMessage(<span class="number">100.</span>millis)</span><br><span class="line"></span><br><span class="line">        valueActor ! <span class="type">GetValue</span></span><br><span class="line">        <span class="keyword">val</span> value: <span class="type">Value</span> = expectMsgType[<span class="type">Value</span>](<span class="number">1000.</span>millis)</span><br><span class="line"></span><br><span class="line">        assert(value == <span class="type">Value</span>(<span class="string">&quot;Hello CSE116&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<br>

<ul>
<li><strong>New</strong>: Use the expectNoMessage method (inherited from TestKit) to wait for messages to resolve before testing</li>
<li>The test suite will wait for the specified amount of time<ul>
<li>If there’s an error on millis, don’t forget to import the duration package<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">expectNoMessage(<span class="number">100.</span>millis)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>In this example, each expectNoMessage will wait for 100 milliseconds before moving to the next line of code<ul>
<li>This allows sample time for messages to be processed in a controlled order</li>
</ul>
</li>
<li>If any message is received while waiting, the test will fail</li>
</ul>
<br>

<ul>
<li>Send a message to an actor that expects a response</li>
<li>The test suite is part of the actor system and can receive the response for testing<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">valueActor ! <span class="type">GetValue</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<br>

<ul>
<li><strong>New</strong>: When you expect to receive a message, call expectMsgType with the message type you expect</li>
<li>The time provided is the maximum amount to time to wait before failing the test<ul>
<li>If we don’t receive a message of type Value within 1 second, this test fails<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> value: <span class="type">Value</span> = expectMsgType[<span class="type">Value</span>](<span class="number">1000.</span>millis)</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>expectMsgType does not wait for the <strong>full duration</strong>!</li>
<li>As soon as a message is received, the test <strong>moves on</strong></li>
<li>This test will wait for 11.5dats, or until it receives a message<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;A string actor&quot;</span> must &#123;</span><br><span class="line">    <span class="string">&quot;track a string&quot;</span> in &#123;</span><br><span class="line">        <span class="keyword">val</span> valueActor = system.actorOf(<span class="type">Props</span>(classOf[<span class="type">StringActor</span>], <span class="string">&quot;Hello&quot;</span>))</span><br><span class="line"></span><br><span class="line">        valueActor ! <span class="type">Append</span>(<span class="string">&quot; CSE&quot;</span>)</span><br><span class="line">        expectNoMessage(<span class="number">100.</span>millis)</span><br><span class="line">        valueActor ! <span class="type">Append</span>(<span class="string">&quot;116&quot;</span>)</span><br><span class="line">        expectNoMessage(<span class="number">100.</span>millis)</span><br><span class="line"></span><br><span class="line">        valueActor ! <span class="type">GetValue</span></span><br><span class="line">        <span class="keyword">val</span> value: <span class="type">Value</span> = expectMsgType[<span class="type">Value</span>](<span class="number">1000000000.</span>millis)</span><br><span class="line"></span><br><span class="line">        assert(value == <span class="type">Value</span>(<span class="string">&quot;Hello CSE116&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<br>

<ul>
<li>When the message is received, use asserts to test it<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">assert(value == <span class="type">Value</span>(<span class="string">&quot;Hello CSE116&quot;</span>))</span><br></pre></td></tr></table></figure>

</li>
</ul>
<br>

<ul>
<li><strong>Caution</strong>: When testing message types with underfined variable names <strong>do not access the variables for testing</strong><ul>
<li>For today’s lecture question, the names of the Int variables are not defined and it is unlikely that we will use the same names</li>
<li>If we use different names =&gt; error in AutoLab</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>Instead, create a new message of that type and check foor equality<ul>
<li>Recall that case classes have an equals method that compares the values of its variables instead of references</li>
</ul>
</li>
</ul>
<hr>
<h1 id="Lecture-Question"><a href="#Lecture-Question" class="headerlink" title="Lecture Question"></a>Lecture Question</h1><p><strong>Task:</strong><br>Create and test an actor class to track funds in a bank account</p>
<ul>
<li>This question is similar to Monday’s in that your actor will only track a single value. Through this question you will practice writing a test suite for actors</li>
<li>In a package named bank create a class named <code>BankAccount</code> that extends Actor</li>
<li>Create the following case class/objects in the bank package that will be used as messages<ul>
<li>A case class named <code>Deposit</code> that takes an Int in its constructor</li>
<li>A case class named <code>Withdraw</code> that takes an Int in its constructor</li>
<li>A case object named <code>CheckBalance</code></li>
<li>A case class named <code>Balance</code> that takes an Int in its constructor</li>
</ul>
</li>
<li>The BankAccount class must:<ul>
<li>Initially contain no funds</li>
<li>When it receives a Deposit message, increases its funds by the amount in the message</li>
<li>When it receives a Withdraw message, decrease its funds by the amount in the message only if the account has enough money to cover the withdrawal. If it doesn’t have enough money for the full withdrawal, no funds are removed</li>
<li>When it receives a CheckBalance message, sends its current funds back to the sender in a Balance message</li>
</ul>
</li>
</ul>
<p><strong>Testing:</strong><br>In a package named tests, write a class named TestBankAccount as a test suite that tests the BankAccount functionality       </p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:tianzheh@buffalo.edu" rel="external nofollow noreferrer">胡天哲</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://tianzhe.me/2020/12/27/LO5-2-Testing-Actors/">https://tianzhe.me/2020/12/27/LO5-2-Testing-Actors/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tianzhe.me" target="_blank">Tianzhe's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Scala/">Scala</a></div><div class="post_share"><div class="social-share" data-image="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/12/27/LO5-3-Actors/"><img class="prev-cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CSE116的学习笔记-Lec5-3:Actors</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/27/LO5-1-Actors/"><img class="next-cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CSE116的学习笔记-Lec5-1:Actors</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/09/24/Inheritance/" title="CSE116的学习笔记 Lec2-1:Inheritance"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-24</div><div class="title">CSE116的学习笔记 Lec2-1:Inheritance</div></div></a></div><div><a href="/2020/09/28/JSON/" title="CSE116的学习笔记-Lec2-3:JSON"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-28</div><div class="title">CSE116的学习笔记-Lec2-3:JSON</div></div></a></div><div><a href="/2020/09/24/Model-of-Execution-2/" title="CSE116的学习笔记-Lec#7:Model of Execution More Example"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-24</div><div class="title">CSE116的学习笔记-Lec#7:Model of Execution More Example</div></div></a></div><div><a href="/2020/09/24/Model-of-Execution-live/" title="CSE116的学习笔记-Lec#8:Model of Execution live"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-24</div><div class="title">CSE116的学习笔记-Lec#8:Model of Execution live</div></div></a></div><div><a href="/2020/09/16/Model-of-Execution/" title="CSE116的学习笔记-Lec#6:Model of Execution"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-16</div><div class="title">CSE116的学习笔记-Lec#6:Model of Execution</div></div></a></div><div><a href="/2020/09/16/Object-Class/" title="CSE116的学习笔记-Lec#5:Object & Class"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Scala_logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-16</div><div class="title">CSE116的学习笔记-Lec#5:Object & Class</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 胡天哲</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">生而为人，我很抱歉</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks"></canvas><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script></div></body></html>